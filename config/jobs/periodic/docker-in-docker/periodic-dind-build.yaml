periodics:
  - name: docker-build
    cluster: k8s-ppc64le-cluster
    decorate: true
    extra_refs:
    - org: ppc64le-cloud
      repo: docker-ce-build
      base_ref: master
    interval: 24h
    spec:
      containers:
      - image: quay.io/powercloud/docker-ce-build
        command:
        - /bin/bash
        args:
        - -c
        - |
          if [[ $PWD != /home/prow/go/src/github.com/ppc64le-cloud/docker-ce-build ]]
          then
            cd /home/prow/go/src/github.com/ppc64le-cloud/docker-ce-build
           fi
           chmod a+x *.sh
          source prowjob-periodic-dind-build.sh
        resources: {}
        securityContext:
          privileged: true
        volumeMounts:
        - name: docker-root
          mountPath: /var/lib/docker
        env:
          - name: DOCKER_SECRET_AUTH
            valueFrom:
              secretKeyRef: 
                name: docker-token
                key: .dockerconfigjson
          - name: S3_SECRET_AUTH
            valueFrom:
              secretKeyRef: 
                name: secret-s3
                key: password
      restartPolicy: Never
      volumes:
      - name: docker-root
        emptyDir: {}
